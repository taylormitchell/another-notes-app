datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Note {
  id        String  @id @default(uuid())
  text      String
  author    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parentListId String?
  parentList   List? @relation(fields: [parentListId], references: [id])

  relatedLists       List[]               @relation("NoteToList")
  NoteToRelatedLists NoteToRelatedLists[]

  parentNoteId String?
  parentNote   Note?  @relation("ParentNote", fields: [parentNoteId], references: [id])
  childNotes   Note[] @relation("ParentNote")

  relatedNotes    Note[] @relation("RelatedNotes")
  backlinkedNotes Note[] @relation("RelatedNotes")
}

model List {
  id                String  @id @default(uuid())
  name               String
  createdAt          DateTime             @default(now())
  notes              Note[]               @relation("NoteToList")
  NoteToRelatedLists NoteToRelatedLists[]
  Note               Note[]
}

model NoteToRelatedLists {
  noteId String
  listId String
  note   Note @relation(fields: [noteId], references: [id])
  list   List @relation(fields: [listId], references: [id])

  @@id([noteId, listId])
}
